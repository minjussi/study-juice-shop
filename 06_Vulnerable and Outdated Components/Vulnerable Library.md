# [⭐⭐⭐⭐] Vulnerable Library

### 📌 express-jwt 0.1.3

- 이 버전은 매우 오래된 버전으로 현대에서는 사용되지 않는 라이브러리이다.
- JWT 서명 검증에서 발생할 수 있는 취약점들에 노출되기가 쉽다.
  - JWT 서명 검증 우회: 특히 공격자가 JWT 헤더의 alg 필드를 `none`으로 수정하여 전송하면, 서버가 서명을 확인하지 않고 토큰이 유효하다고 판단하여 관리자 권한 등을 탈취할 수 있다. 또, 비밀키가 없어도 토큰 조작이 가능하다.  
  - 잘못된 설정: 특정 에러 발생 시에 인증 과정을 건너뛰고 다음 미들웨어로 요청을 넘겨버리는 인증 무력화 현상이 발생할 수 있다. 

### 📌 Middleware (미들웨어) 작동 원리

- express 앱은 요청이 들어오면 여러 개의 미들웨어를 거치게 된다. 이때 미들웨어가 일을 끝내면 next() 함수를 호출해 다음 순서로 넘겨주게 된다.
#### 1. 정상적인 인증 성공 상황
  1. **로그인 체크 미들웨어**: 로그인 토큰 검사
  2. **검증 완료**: 토큰이 맞는 것을 확인하고 next 함수 호출
  3. **마이페이지 미들웨어**: 인증된 사용자에 한하여 민감 정보 노출

#### 2.인증 우회가 발생하는 경우
  1. **로그인 체크 미들웨어**: 공격자가 조작된 토큰을 전송
  2. **에러 발생 혹은 로직 결함**: 인증 과정에서 에러가 발생했음을 확인 
  3. **`취약점 발생`**: 에러가 발생했음에도 불구하고 next 함수를 호출
  4. **마이페이지 미들웨어**: 민감 정보 노출 -> `유효한 키가 없어도 정보가 노출되는 취약점 발생`

### 🔓 문제 풀이

- 취약한 라이브러리와 그 버전을 찾는 문제이다. (앞선 문제에서 얻은 백업 파일을 활용하여 사용된 라이브러리를 모두 확인해 취약한 라이브러리를 찾는 문제이다.)
- 찾은 취약 라이브러리를 complain 탭에 입력하면 문제를 해결할 수 있다.
<p align="center">
  <img src="https://github.com/user-attachments/assets/1ea0a441-e403-4707-a586-ae494f1369c7" width="45%"/>
</p>

### 🔐 Mitigation Strategy 

- 취약점이 패치된 최신 버전으로 업데이트를 한다. (express-jwt의 경우에는 6.0.0 혹은 그 이상 버전으로 패치해야한다.)
