# [β­] DOM XSS

### π“ Cross-site scripting (XSS)

XSSλ” μ·¨μ•½ν• μ›Ήμ‚¬μ΄νΈλ¥Ό μ΅°μ‘ν•΄ μ‚¬μ©μμ—κ² μ•…μμ μΈ Javascript μ‹¤ν–‰ κ²°κ³Όλ¥Ό μ κ³µν•λ” μ›Ή μ·¨μ•½μ μ μΌμΆ…μ΄λ‹¤. μ•…μμ μΈ μ½”λ“κ°€ ν”Όν•΄μμ λΈλΌμ°μ €μ—μ„ μ‹¤ν–‰λλ©΄, κ³µκ²©μλ” ν”Όν•΄μμ κ¶ν•μΌλ΅ λΈλΌμ°μ €λ¥Ό μ„μλ΅ μ΅°μ‘ν•  μ μκ² λλ‹¤. 

### π“ XSS PoC

- ν†µμƒμ μΌλ΅ μ·¨μ•½μ μ„ ν™•μΈν•κΈ° μ„ν•΄ μ§§μ€ javascript μ½”λ“μΈ alert() ν•¨μλ¥Ό λ§μ΄ μ‚¬μ©ν–λ‹¤.

- ν¬λ΅¬ 92 λ²„μ „λ¶€ν„°λ” cross-origin iframe μ•μ—μ„ alert()μ νΈμ¶μ΄ λ§‰ν”λ‹¤. (iframeμ€ λ‹¤λ¥Έ μ‚¬μ΄νΈ μ½ν…μΈ λ¥Ό μ‚½μ…(cross-origin)ν•  λ• μμ£Ό μ‚¬μ©ν•λ” HTML νƒκ·ΈμΈλ°, λ³΄μ• κ°•ν™” μ°¨μ›μ—μ„ λ§‰ν”λ‹¤.(same-origin Policy λ•λ¬Έ))

- μ΄λ° κ²½μ°μ—λ” print() ν•¨μλ¥Ό λ€μ‹ ν•΄μ„ μ‚¬μ©ν•΄ λΈλΌμ°μ €μ—μ„ μΈμ‡„ λ€ν™”μ°½μ„ ν™μ©ν•΄ μ‹¤ν–‰ κ²°κ³Όλ¥Ό ν™•μΈν•  μ μλ‹¤. 


### π“ DOM-based XSS κ°λ… (μ¶μ² : PortSwigger)

- DOM-based XSSλ” Javascriptμ—μ„ κ³µκ²©μκ°€ μ μ–΄ν•  μ μλ” sourceμ— μλ” λ°μ΄ν„°λ¥Ό κ°€μ Έμ™€ eval()μ΄λ‚ innerHTML κ°™μ€ λ™μ  μ½”λ“λ¥Ό μ‹¤ν–‰ν•λ” ν•¨μμ— μ „λ‹¬ν•΄ κ³µκ²©μκ°€ μ„μλ΅ λ„£μ€ μ½”λ“λ¥Ό ν΄λΌμ΄μ–ΈνΈ λ‹¨μ—μ„ μ‹¤ν–‰ν•  μ μκ² ν•λ‹¤. (νΉν νƒ€μΈμ κ³„μ •μ„ ν›”μΉ  λ• μ μ©ν•κ² μ‚¬μ©λλ‹¤.)
  
- DOM-based XSSλ¥Ό μ‹¤ν–‰ν•λ ¤λ©΄ ν•΄λ‹Ή sourceμ— λ‚΄κ°€ λ„£μ–΄μ„ κ³µκ²©ν•κ³ μ ν•λ” dataλ¥Ό μ‚½μ…ν•΄ Javascriptμ—μ„ μ‹¤ν–‰λλ„λ΅ λ§λ“¤μ–΄μ•Ό ν•λ‹¤. 
  
- κ°€μ¥ ν”ν•κ² κ³µκ²©μκ°€ μ μ–΄ν•  μ μλ” sourceλ” urlλ΅, μ·¨μ•½ν• νμ΄μ§€λ΅ μ΄λ™ν•κ² ν•λ” λ§ν¬λ¥Ό λ§λ“¤μ–΄ μ „λ‹¬ν•λ” λ°©λ²•μ΄ μλ‹¤.


### π”“ λ¬Έμ  ν’€μ΄

- DOM-based XSS κ³µκ²©μ„ μ‹λ„ν•λ ¤λ©΄, κ³µκ²©μ„ μ‹λ„ν•΄ μ„μμ μ½”λ“λ¥Ό μ‹¤ν–‰ν•κ² ν•λ” μ„μΉλ¥Ό λ¨Όμ € μ°Ύμ•„μ•Ό ν•λ‹¤. (payloadλ” μ •ν•΄μ Έ μλ‹¤- <iframe src="javascript:alert(`xss`)">)

- μ²« λ²μ§Έλ΅ μ‹λ„ν•΄ λ³Έ κ²ƒμ€ localhost:3000/#/<iframe src="javascript:alert(`xss`)"> μ™€ κ°™μ΄ urlμ— κ³µκ²© payloadλ¥Ό μ‚½μ…ν•λ” κ²ƒμ΄μ—λ‹¤. (μ΄λ” urlμ— μ‹¤ν–‰ν•  μ μλ” payloadλ¥Ό μ‚½μ…ν• κ²ƒμ΄ μ•„λ‹λΌ λ‹¨μ§€ λ””λ ‰ν† λ¦¬ μ΄λ™μ„ ν• κ²ƒμ— λ¶κ³Όν•¨μΌλ΅ μ‹¤ν–‰ν•κ³ μ ν•λ” μ½”λ“κ°€ μ‹¤ν–‰μ΄ λ  μ μ—†λ‹¤.)

<img width="2811" height="1469" alt="image" src="https://github.com/user-attachments/assets/d8ff1a93-4ecf-4bba-bd91-60a2e68a0aa4" />




- κ²€μƒ‰μ°½μ urlμ„ μ‚΄ν΄λ³΄λ©΄ *search? q=* μ™€ κ°™μ΄ url νλΌλ―Έν„° κ°’μ„ μ „λ‹¬ν•΄ κ²€μƒ‰μ„ μ§„ν–‰ν•λ” κ²ƒμ„ μ• μ μλ‹¤. κ²€μƒ‰ νλΌλ―Έν„° κ°’μΌλ΅ κ³µκ²©μκ°€ μ„μλ΅ μ‹¤ν–‰ν•κ³ μ ν•λ” payloadλ¥Ό μ‚½μ…ν•λ©΄ ν•΄λ‹Ή μ½”λ“κ°€ μ‹¤ν–‰λ  μ μμμ„ μ• μ μλ‹¤. 
(http://localhost:3000/#/search?q=%20%3Ciframe%20src%3D%22javascript:alert(%60xss%60)%22%3E)




### π” Mitigation Strategy


<p align="center">
  <img src="https://github.com/user-attachments/assets/28598f0c-1462-44e2-979d-6e8ad349875e" width="45%" style="margin-right:10px;"/>
  <img src="https://github.com/user-attachments/assets/6170b56b-21e0-4957-96ee-f7aca884fa3b" width="45%"/>
</p>


- μ½”λ“λ¥Ό λ” μμ„Έν μ‚΄ν΄λ³΄λ©΄ νλΌλ―Έν„°λ΅ μ…λ ¥λ κ°’μ΄ sanitizerλ¥Ό μ°νν•λ” κ²ƒμ΄ κ°€λ¥ν• μ½”λ“κ°€ μλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

- μ΄λ¥Ό μ¤λ¥Έμ½μ²λΌ μ…λ ¥κ°’μ΄ sanitizerλ¥Ό κ±°μ³ ν•„ν„°λ§μ„ κ±°μΉ λ‹¤μμ— μ…λ ¥λλ„λ΅ μμ •ν•λ©΄ λ³΄μ• μ΅°μΉλ¥Ό ν•  μ μλ‹¤. 
